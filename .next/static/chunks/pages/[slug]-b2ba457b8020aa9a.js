(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[219],{1587:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/[slug]",function(){return i(2577)}])},2577:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return p}});var n=i(5893),o=i(7294);function l(e,t,i){return function(e){let t=0;for(let i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i),t&=t;return Math.abs(t)}("".concat(e,",").concat(t,",").concat(i))%(({home:1,residential:3,commercial:3,park:2,road:1})[i]||1)}function r(e,t){let i=e||"minha-cidade",n="".concat(i,"-home-0"),o={id:n,x:0,y:0,type:"home",stage:1,level:1,variant:l(0,0,"home"),createdAtVisit:0};return{buildings:{[n]:o},visits:0,population:1,seed:i,name:t||e||"Minha Cidade",createdAt:Date.now(),slug:e}}function a(e,t,i){let n=function(e,t,i){let n=function(e){let t=0;for(let i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i),t&=t;return Math.abs(t)}("".concat(t,"-").concat(i)),o=new Set;for(let t of Object.values(e.buildings))o.add("".concat(t.x,",").concat(t.y));for(let e=1;e<=20;e++){let t=[];for(let i=-e;i<=e;i++)for(let n=-e;n<=e;n++){let o=i*i+n*n;o>(e-1)*(e-1)&&o<=e*e&&t.push({x:i,y:n})}t.sort((e,t)=>e.x!==t.x?e.x-t.x:e.y-t.y);for(let e=0;e<t.length;e++){let i=(n+e)%t.length,l=t[i],r="".concat(l.x,",").concat(l.y);if(!o.has(r))return l}}return null}(e,e.seed,i);if(!n)return;let o="".concat(e.seed,"-").concat(t,"-").concat(i);e.buildings[o]={id:o,x:n.x,y:n.y,type:t,stage:1,level:1,variant:l(n.x,n.y,t),createdAtVisit:i}}function s(e){let{type:t,level:i,variant:l=0,size:r=64,label:a,showDebug:s=!1,styleSeed:d}=e,[c,u]=(0,o.useState)(!1),[p,f]=(0,o.useState)(!1),h=(0,o.useRef)(i);(0,o.useEffect)(()=>{if(i>h.current){f(!0);let e=setTimeout(()=>f(!1),500);return h.current=i,()=>clearTimeout(e)}h.current=i},[i]);let g=function(e,t){return(arguments.length>2&&void 0!==arguments[2]&&arguments[2],"empty"===e)?"/tiles/empty.svg":"/tiles/".concat({residential:"res",commercial:"com",park:"par",road:"road",home:"home"}[e]||"empty","_").concat({1:1,2:2,3:4}[Math.min(Math.max(t,1),3)]||1,".svg")}(t,i,l),m=s?"".concat(t.substring(0,3)," L").concat(i," V").concat(l).concat(void 0!==d?" S".concat(d):""):void 0,v=a||m;return(0,n.jsxs)("div",{style:{position:"relative",width:r,height:r,display:"flex",alignItems:"center",justifyContent:"center"},onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),children:[(0,n.jsxs)("div",{style:{width:"100%",height:"100%",transform:p?"scale(1.08)":"scale(1.0)",transition:p?"transform 0.15s ease-out":"transform 0.3s ease-in",position:"relative"},children:[(0,n.jsx)("img",{src:g,alt:"".concat(t," level ").concat(i),style:{width:"100%",height:"100%",objectFit:"contain",imageRendering:"pixelated"}}),p&&(0,n.jsx)("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,boxShadow:"0 0 8px rgba(255, 215, 0, 0.6)",pointerEvents:"none",borderRadius:"2px"}})]}),c&&v&&(0,n.jsx)("div",{style:{position:"absolute",bottom:"100%",left:"50%",transform:"translateX(-50%)",backgroundColor:"rgba(0,0,0,0.8)",color:"white",padding:"4px 8px",fontSize:"10px",borderRadius:"4px",whiteSpace:"nowrap",marginBottom:"4px",pointerEvents:"none",zIndex:10},children:v}),s&&m&&(0,n.jsx)("div",{style:{position:"absolute",top:"2px",right:"2px",backgroundColor:"rgba(0,0,0,0.7)",color:"white",padding:"2px 4px",fontSize:"8px",borderRadius:"2px",fontWeight:"bold",zIndex:5},children:m})]})}function d(e){let{city:t,cameraX:i=0,cameraY:o=0,size:l=21,showDebug:r=!1}=e;if(!t||!t.buildings)return(0,n.jsx)("div",{children:"Carregando cidade..."});let a=new Map;for(let e of Object.values(t.buildings||{}))e&&void 0!==e.x&&void 0!==e.y&&a.set("".concat(e.x,",").concat(e.y),e);let d=Math.floor(l/2),c=i-d,u=i+d,p=o-d,f=o+d,h=[];for(let e=f;e>=p;e--)for(let t=c;t<=u;t++){var g,m;let i="".concat(t,",").concat(e),o=a.get(i),l={position:"relative",border:"1px solid #ddd",width:"100%",height:"100%",minHeight:"64px",minWidth:"64px",display:"flex",alignItems:"center",justifyContent:"center",padding:"2px",backgroundColor:"#f5f5f5",overflow:"hidden"},d=(null==o?void 0:o.type)||"empty",c=null!==(g=null==o?void 0:o.level)&&void 0!==g?g:(null==o?void 0:o.stage)?Math.min(o.stage,3):1,u=null!==(m=null==o?void 0:o.variant)&&void 0!==m?m:0,p=(null==o?void 0:o.type)?function(e,t){let i=function(e){let t=0;for(let i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i),t&=t;return Math.abs(t)}("".concat(e,"-").concat(t));return{roof:i%3,windows:Math.floor(i/3)%3,accentColorIndex:Math.floor(i/9)%4,styleSeed:i}}(o.type,u):null,f=null==p?void 0:p.styleSeed;h.push((0,n.jsx)("div",{style:l,children:(0,n.jsx)(s,{type:d,level:c,variant:u,size:64,showDebug:r,styleSeed:f})},i))}return(0,n.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(".concat(l,", 1fr)"),gap:"1px",border:"2px solid #333",padding:"4px",backgroundColor:"#fff",maxWidth:"100%",overflow:"auto"},children:h})}function c(e){return"mmw:city:".concat(e)}function u(e){try{localStorage.setItem(c(e.slug||e.seed),JSON.stringify(e))}catch(e){}}function p(){var e;let[t,i]=(0,o.useState)(null),[s,p]=(0,o.useState)(!0),f=(0,o.useMemo)(()=>(window.location.pathname.split("/").pop()||"minha-cidade").toLowerCase().trim(),[]),h=(0,o.useMemo)(()=>new URL(window.location.href).searchParams.get("name")||void 0,[]);function g(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(!t)return;let n=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i={...e};for(let e=0;e<t;e++)i=function(e){let t=e.visits+1,i={...e,visits:t,population:e.population+1,buildings:{...e.buildings}};if(3===t)a(i,"residential",t);else if(6===t)a(i,"road",t);else if(10===t)a(i,"commercial",t);else if(t>10&&(t-10)%5==0){let e=["residential","commercial","park"],n=Math.floor((t-10)/5)%e.length;a(i,e[n],t)}return i.buildings=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,n={...e},o=Math.floor(t/i),l=Object.values(e).sort((e,t)=>e.createdAtVisit-t.createdAtVisit),r=0;for(let e of l){if(r>=o)break;let t={home:3,residential:3,commercial:4,park:2,road:2}[e.type]||3,i=Math.min(t-e.level,o-r);if(i>0){let o=e.level+i;n[e.id]={...e,level:o,stage:o===t?4:o},r+=i}}return n}(i.buildings,t,3),i}(i);return i}(t,e);u(n),i(n)}if((0,o.useEffect)(()=>{let e=function(e){try{let t=localStorage.getItem(c(e));if(!t)return null;let i=JSON.parse(t);return function(e,t){var i,n,o,a,s,d,c,u,p;if(!e||"object"!=typeof e)return r(t);if(e.buildings&&"object"==typeof e.buildings){let t=!1,o={};for(let[r,a]of Object.entries(e.buildings||{}))void 0===a.level||void 0===a.variant?(t=!0,o[r]={...a,level:null!==(i=a.level)&&void 0!==i?i:a.stage?Math.min(a.stage,3):1,variant:null!==(n=a.variant)&&void 0!==n?n:void 0!==a.x&&void 0!==a.y&&a.type?l(a.x,a.y,a.type):0}):o[r]=a;return t?{...e,buildings:o}:e}if(e.board&&"object"==typeof e.board){let i=r(t,null!==(a=null!==(o=e.name)&&void 0!==o?o:e.cityName)&&void 0!==a?a:t);return i.visits=Number(null!==(d=null!==(s=e.visits)&&void 0!==s?s:e.totalVisits)&&void 0!==d?d:0),i.population=Number(null!==(c=e.population)&&void 0!==c?c:1),i}return r(t,null!==(p=null!==(u=e.name)&&void 0!==u?u:e.cityName)&&void 0!==p?p:t)}(i,e)}catch(e){return null}}(f);if(e){let t=localStorage.getItem(c(f));if(t)try{!JSON.parse(t).buildings&&e.buildings&&u(e)}catch(e){}i(e),p(!1);return}let t=r(f,h);u(t),i(t),p(!1)},[f,h]),s||!t)return(0,n.jsx)("main",{style:{padding:40,fontFamily:"system-ui, Arial"},children:(0,n.jsx)("h2",{children:"Carregando cidadeâ€¦"})});let m=Object.keys(null!==(e=null==t?void 0:t.buildings)&&void 0!==e?e:{}).length;return(0,n.jsxs)("main",{style:{padding:40,fontFamily:"system-ui, Arial"},children:[(0,n.jsx)("h1",{style:{marginBottom:6},children:t.name}),(0,n.jsxs)("p",{style:{marginTop:0,opacity:.75},children:["Slug: ",(0,n.jsx)("code",{children:t.slug||t.seed})]}),(0,n.jsxs)("div",{style:{marginTop:18,border:"1px solid #3333",padding:16,borderRadius:8,maxWidth:560},children:[(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Visitas:"})," ",t.visits]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Popula\xe7\xe3o:"})," ",t.population]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Total de buildings:"})," ",m]}),(0,n.jsxs)("div",{style:{display:"flex",gap:10,marginTop:14,flexWrap:"wrap"},children:[(0,n.jsx)("button",{onClick:()=>g(1),style:{padding:"10px 12px",cursor:"pointer"},children:"Simular visita (+1)"}),(0,n.jsx)("button",{onClick:()=>g(10),style:{padding:"10px 12px",cursor:"pointer"},children:"Simular 10 visitas"}),(0,n.jsx)("button",{onClick:function(){localStorage.removeItem(c(f));let e=r(f,h);u(e),i(e)},style:{padding:"10px 12px",cursor:"pointer"},children:"Resetar cidade"}),(0,n.jsx)("button",{disabled:!0,style:{padding:"10px 12px",cursor:"not-allowed",opacity:.5,backgroundColor:"#f0f0f0"},children:"IA desligada"})]})]}),(0,n.jsxs)("div",{style:{marginTop:24},children:[(0,n.jsx)("h2",{style:{marginTop:0},children:"Visualiza\xe7\xe3o da Cidade"}),(0,n.jsx)(d,{city:t,cameraX:0,cameraY:0,size:21})]})]})}}},function(e){e.O(0,[888,774,179],function(){return e(e.s=1587)}),_N_E=e.O()}]);