(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[219],{1587:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/[slug]",function(){return i(1888)}])},1888:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return p}});var n=i(5893),l=i(7294);function o(e,t,i){return function(e){let t=0;for(let i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i),t&=t;return Math.abs(t)}("".concat(e,",").concat(t,",").concat(i))%(({home:1,residential:3,commercial:3,park:2,road:1})[i]||1)}function r(e,t){let i=e||"minha-cidade",n="".concat(i,"-home-0"),l={id:n,x:0,y:0,type:"home",stage:1,level:1,variant:o(0,0,"home"),createdAtVisit:0};return{buildings:{[n]:l},visits:0,population:1,seed:i,name:t||e||"Minha Cidade",createdAt:Date.now(),slug:e}}function a(e,t,i){let n=function(e,t,i){let n=function(e){let t=0;for(let i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i),t&=t;return Math.abs(t)}("".concat(t,"-").concat(i)),l=new Set;for(let t of Object.values(e.buildings))l.add("".concat(t.x,",").concat(t.y));for(let e=1;e<=20;e++){let t=[];for(let i=-e;i<=e;i++)for(let n=-e;n<=e;n++){let l=i*i+n*n;l>(e-1)*(e-1)&&l<=e*e&&t.push({x:i,y:n})}t.sort((e,t)=>e.x!==t.x?e.x-t.x:e.y-t.y);for(let e=0;e<t.length;e++){let i=(n+e)%t.length,o=t[i],r="".concat(o.x,",").concat(o.y);if(!l.has(r))return o}}return null}(e,e.seed,i);if(!n)return;let l="".concat(e.seed,"-").concat(t,"-").concat(i);e.buildings[l]={id:l,x:n.x,y:n.y,type:t,stage:1,level:1,variant:o(n.x,n.y,t),createdAtVisit:i}}function s(e){let{type:t,level:i,variant:o=0,size:r=64,label:a,showDebug:s=!1}=e,[d,c]=(0,l.useState)(!1),u=function(e,t){return(arguments.length>2&&void 0!==arguments[2]&&arguments[2],"empty"===e)?"/tiles/empty.svg":"/tiles/".concat({residential:"res",commercial:"com",park:"par",road:"road",home:"home"}[e]||"empty","_").concat({1:1,2:2,3:4}[Math.min(Math.max(t,1),3)]||1,".svg")}(t,i,o),p=a||(s?"".concat(t.substring(0,3)," L").concat(i," V").concat(o):void 0);return(0,n.jsxs)("div",{style:{position:"relative",width:r,height:r,display:"flex",alignItems:"center",justifyContent:"center"},onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),children:[(0,n.jsx)("img",{src:u,alt:"".concat(t," level ").concat(i),style:{width:"100%",height:"100%",objectFit:"contain",imageRendering:"pixelated"}}),d&&p&&(0,n.jsx)("div",{style:{position:"absolute",bottom:"100%",left:"50%",transform:"translateX(-50%)",backgroundColor:"rgba(0,0,0,0.8)",color:"white",padding:"4px 8px",fontSize:"10px",borderRadius:"4px",whiteSpace:"nowrap",marginBottom:"4px",pointerEvents:"none"},children:p}),s&&p&&(0,n.jsx)("div",{style:{position:"absolute",top:"2px",right:"2px",backgroundColor:"rgba(0,0,0,0.7)",color:"white",padding:"2px 4px",fontSize:"8px",borderRadius:"2px",fontWeight:"bold"},children:p})]})}function d(e){let{city:t,cameraX:i=0,cameraY:l=0,size:o=21,showDebug:r=!1}=e;if(!t||!t.buildings)return(0,n.jsx)("div",{children:"Carregando cidade..."});let a=new Map;for(let e of Object.values(t.buildings||{}))e&&void 0!==e.x&&void 0!==e.y&&a.set("".concat(e.x,",").concat(e.y),e);let d=Math.floor(o/2),c=i-d,u=i+d,p=l-d,g=l+d,f=[];for(let e=g;e>=p;e--)for(let t=c;t<=u;t++){var h,v;let i="".concat(t,",").concat(e),l=a.get(i),o={position:"relative",border:"1px solid #ddd",width:"100%",height:"100%",minHeight:"64px",minWidth:"64px",display:"flex",alignItems:"center",justifyContent:"center",padding:"2px",backgroundColor:"#f5f5f5",overflow:"hidden"},d=(null==l?void 0:l.type)||"empty",c=null!==(h=null==l?void 0:l.level)&&void 0!==h?h:(null==l?void 0:l.stage)?Math.min(l.stage,3):1,u=null!==(v=null==l?void 0:l.variant)&&void 0!==v?v:0,p=r&&l?"".concat(l.type.substring(0,3)," L").concat(c," V").concat(u):void 0;f.push((0,n.jsx)("div",{style:o,children:(0,n.jsx)(s,{type:d,level:c,variant:u,size:64,label:p,showDebug:r})},i))}return(0,n.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(".concat(o,", 1fr)"),gap:"1px",border:"2px solid #333",padding:"4px",backgroundColor:"#fff",maxWidth:"100%",overflow:"auto"},children:f})}function c(e){return"mmw:city:".concat(e)}function u(e){try{localStorage.setItem(c(e.slug||e.seed),JSON.stringify(e))}catch(e){}}function p(){var e;let[t,i]=(0,l.useState)(null),[s,p]=(0,l.useState)(!0),g=(0,l.useMemo)(()=>(window.location.pathname.split("/").pop()||"minha-cidade").toLowerCase().trim(),[]),f=(0,l.useMemo)(()=>new URL(window.location.href).searchParams.get("name")||void 0,[]);function h(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(!t)return;let n=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i={...e};for(let e=0;e<t;e++)i=function(e){let t=e.visits+1,i={...e,visits:t,population:e.population+1,buildings:{...e.buildings}};if(3===t)a(i,"residential",t);else if(6===t)a(i,"road",t);else if(10===t)a(i,"commercial",t);else if(t>10&&(t-10)%5==0){let e=["residential","commercial","park"],n=Math.floor((t-10)/5)%e.length;a(i,e[n],t)}return i.buildings=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,n={...e},l=Math.floor(t/i),o=Object.values(e).sort((e,t)=>e.createdAtVisit-t.createdAtVisit),r=0;for(let e of o){if(r>=l)break;let t=Math.min(3-e.level,l-r);if(t>0){let i=e.level+t;n[e.id]={...e,level:i,stage:3===i?4:i},r+=t}}return n}(i.buildings,t,3),i}(i);return i}(t,e);u(n),i(n)}if((0,l.useEffect)(()=>{let e=function(e){try{let t=localStorage.getItem(c(e));if(!t)return null;let i=JSON.parse(t);return function(e,t){var i,n,l,a,s,d,c,u,p;if(!e||"object"!=typeof e)return r(t);if(e.buildings&&"object"==typeof e.buildings){let t=!1,l={};for(let[r,a]of Object.entries(e.buildings||{}))void 0===a.level||void 0===a.variant?(t=!0,l[r]={...a,level:null!==(i=a.level)&&void 0!==i?i:a.stage?Math.min(a.stage,3):1,variant:null!==(n=a.variant)&&void 0!==n?n:void 0!==a.x&&void 0!==a.y&&a.type?o(a.x,a.y,a.type):0}):l[r]=a;return t?{...e,buildings:l}:e}if(e.board&&"object"==typeof e.board){let i=r(t,null!==(a=null!==(l=e.name)&&void 0!==l?l:e.cityName)&&void 0!==a?a:t);return i.visits=Number(null!==(d=null!==(s=e.visits)&&void 0!==s?s:e.totalVisits)&&void 0!==d?d:0),i.population=Number(null!==(c=e.population)&&void 0!==c?c:1),i}return r(t,null!==(p=null!==(u=e.name)&&void 0!==u?u:e.cityName)&&void 0!==p?p:t)}(i,e)}catch(e){return null}}(g);if(e){let t=localStorage.getItem(c(g));if(t)try{!JSON.parse(t).buildings&&e.buildings&&u(e)}catch(e){}i(e),p(!1);return}let t=r(g,f);u(t),i(t),p(!1)},[g,f]),s||!t)return(0,n.jsx)("main",{style:{padding:40,fontFamily:"system-ui, Arial"},children:(0,n.jsx)("h2",{children:"Carregando cidadeâ€¦"})});let v=Object.keys(null!==(e=null==t?void 0:t.buildings)&&void 0!==e?e:{}).length;return(0,n.jsxs)("main",{style:{padding:40,fontFamily:"system-ui, Arial"},children:[(0,n.jsx)("h1",{style:{marginBottom:6},children:t.name}),(0,n.jsxs)("p",{style:{marginTop:0,opacity:.75},children:["Slug: ",(0,n.jsx)("code",{children:t.slug||t.seed})]}),(0,n.jsxs)("div",{style:{marginTop:18,border:"1px solid #3333",padding:16,borderRadius:8,maxWidth:560},children:[(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Visitas:"})," ",t.visits]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Popula\xe7\xe3o:"})," ",t.population]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Total de buildings:"})," ",v]}),(0,n.jsxs)("div",{style:{display:"flex",gap:10,marginTop:14,flexWrap:"wrap"},children:[(0,n.jsx)("button",{onClick:()=>h(1),style:{padding:"10px 12px",cursor:"pointer"},children:"Simular visita (+1)"}),(0,n.jsx)("button",{onClick:()=>h(10),style:{padding:"10px 12px",cursor:"pointer"},children:"Simular 10 visitas"}),(0,n.jsx)("button",{onClick:function(){localStorage.removeItem(c(g));let e=r(g,f);u(e),i(e)},style:{padding:"10px 12px",cursor:"pointer"},children:"Resetar cidade"}),(0,n.jsx)("button",{disabled:!0,style:{padding:"10px 12px",cursor:"not-allowed",opacity:.5,backgroundColor:"#f0f0f0"},children:"IA desligada"})]})]}),(0,n.jsxs)("div",{style:{marginTop:24},children:[(0,n.jsx)("h2",{style:{marginTop:0},children:"Visualiza\xe7\xe3o da Cidade"}),(0,n.jsx)(d,{city:t,cameraX:0,cameraY:0,size:21})]})]})}}},function(e){e.O(0,[888,774,179],function(){return e(e.s=1587)}),_N_E=e.O()}]);